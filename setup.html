<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kurulum SihirbazÄ± - Kojenerasyon Sistemi</title>
    <link rel="stylesheet" href="css/modern.css?v=20260130-1">
    <style>
        .wizard-container { max-width: 900px; margin: 50px auto; padding: 20px; }
        .wizard-header { text-align: center; margin-bottom: 40px; }
        .wizard-header h1 { color: var(--text-primary); margin-bottom: 10px; font-size: 2.5rem; }
        .wizard-header p { color: var(--text-secondary); font-size: 1.1rem; }
        
        .progress-bar { display: flex; justify-content: space-between; margin-bottom: 40px; position: relative; }
        .progress-bar::before {
            content: ''; position: absolute; top: 20px; left: 0; right: 0; height: 2px;
            background: var(--border-color); z-index: 1;
        }
        .progress-bar::after {
            content: ''; position: absolute; top: 20px; left: 0; height: 2px;
            background: var(--gradient-primary); z-index: 2; transition: width 0.3s ease;
        }
        .progress-bar[data-step="1"]::after { width: 0%; }
        .progress-bar[data-step="2"]::after { width: 33.33%; }
        .progress-bar[data-step="3"]::after { width: 66.66%; }
        .progress-bar[data-step="4"]::after { width: 100%; }
        
        .progress-step { position: relative; z-index: 3; text-align: center; flex: 1; }
        .progress-step .step-number {
            width: 40px; height: 40px; border-radius: 50%; background: var(--bg-input);
            border: 2px solid var(--border-color); color: var(--text-muted);
            display: flex; align-items: center; justify-content: center; margin: 0 auto 10px;
            font-weight: 600; transition: all 0.3s ease;
        }
        .progress-step.active .step-number { background: var(--gradient-primary); border-color: var(--accent-primary); color: white; }
        .progress-step.completed .step-number { background: var(--gradient-success); border-color: var(--accent-success); color: white; }
        .progress-step .step-title { font-size: 0.9rem; color: var(--text-muted); font-weight: 500; }
        .progress-step.active .step-title { color: var(--text-primary); }
        
        .wizard-card {
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: 16px; padding: 40px; backdrop-filter: blur(10px);
        }
        
        .step-content { display: none; }
        .step-content.active { display: block; }
        
        .form-section { margin-bottom: 30px; }
        .form-section h3 { color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        .form-group.full-width { grid-column: 1 / -1; }
        
        .help-text {
            background: rgba(52, 152, 219, 0.1); border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 8px; padding: 15px; margin-top: 20px;
        }
        .help-text h4 { color: var(--accent-primary); margin-bottom: 10px; }
        .help-text ul { margin: 0; padding-left: 20px; color: var(--text-secondary); }
        
        .wizard-actions { display: flex; justify-content: space-between; gap: 20px; margin-top: 30px; }
        
        .btn {
            padding: 12px 30px; border: none; border-radius: 8px; font-size: 16px;
            font-weight: 600; cursor: pointer; transition: all 0.3s ease;
            display: inline-flex; align-items: center; gap: 8px;
        }
        .btn-primary { background: var(--gradient-primary); color: white; }
        .btn-secondary { background: var(--bg-input); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-success { background: var(--gradient-success); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2); }
        
        .validation-status {
            display: flex; align-items: center; gap: 10px; padding: 15px;
            border-radius: 8px; margin-bottom: 20px;
        }
        .validation-status.success { background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: var(--accent-success); }
        .validation-status.error { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: var(--accent-error); }
        .validation-status.warning { background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); color: var(--accent-warning); }
        
        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            .wizard-actions { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="wizard-container">
        <div class="wizard-header">
            <h1>âš¡ Kojenerasyon Sistemi Kurulumu</h1>
            <p>Google Sheets API entegrasyonu ve sistem yapÄ±landÄ±rmasÄ± iÃ§in sihirbazÄ± takip edin</p>
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-bar" data-step="1">
            <div class="progress-step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-title">Google API</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-title">OAuth 2.0</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-title">Validation</div>
            </div>
            <div class="progress-step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-title">Complete</div>
            </div>
        </div>
        
        <!-- Step 1: Google API Configuration -->
        <div class="wizard-card">
            <div class="step-content active" data-step="1">
                <h2>ğŸ” Google API AyarlarÄ±</h2>
                <p>Google Sheets API'ye eriÅŸim iÃ§in gerekli anahtarlarÄ± yapÄ±landÄ±rÄ±n.</p>
                
                <div class="form-section">
                    <h3>ğŸ“Š Google Sheets API</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Google API Key *</label>
                            <input type="password" id="api-key" class="form-input" placeholder="AIzaSy..." required>
                            <small class="form-help">Google Cloud Console'dan aldÄ±ÄŸÄ±nÄ±z API anahtarÄ±</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Spreadsheet ID *</label>
                            <input type="text" id="spreadsheet-id" class="form-input" placeholder="1ulhuSPzsICrbNX0jAIqQcFeWcQBXifSAXWwJzfmmyCc" required>
                            <small class="form-help">Google Sheets URL'sinden alÄ±nan belge ID</small>
                        </div>
                    </div>
                </div>
                
                <div class="help-text">
                    <h4>ğŸ“‹ NasÄ±l API Key AlÄ±nÄ±r?</h4>
                    <ul>
                        <li><a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a>'u aÃ§Ä±n</li>
                        <li>Yeni proje oluÅŸturun veya mevcut projeyi seÃ§in</li>
                        <li>"Google Sheets API"yi etkinleÅŸtirin</li>
                        <li>"Credentials" bÃ¶lÃ¼mÃ¼nden "API Key" oluÅŸturun</li>
                        <li>API key'i kopyalayÄ±p yukarÄ±ya yapÄ±ÅŸtÄ±rÄ±n</li>
                    </ul>
                </div>
            </div>
            
            <!-- Step 2: OAuth 2.0 Configuration -->
            <div class="step-content" data-step="2">
                <h2>ğŸ”‘ OAuth 2.0 AyarlarÄ±</h2>
                <p>KullanÄ±cÄ± giriÅŸi ve veri yazma izinleri iÃ§in OAuth 2.0 yapÄ±landÄ±rÄ±n.</p>
                
                <div class="form-section">
                    <h3>ğŸ” OAuth 2.0 Credentials</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Client ID *</label>
                            <input type="text" id="client-id" class="form-input" placeholder="548462430886-...apps.googleusercontent.com" required>
                            <small class="form-help">OAuth 2.0 Client ID</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Client Secret *</label>
                            <input type="password" id="client-secret" class="form-input" placeholder="GOCSPX-..." required>
                            <small class="form-help">OAuth 2.0 Client Secret</small>
                        </div>
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">Redirect URI *</label>
                        <input type="url" id="redirect-uri" class="form-input" value="http://localhost:3000/oauth-callback.html" required>
                        <small class="form-help">OAuth yÃ¶nlendirme adresi</small>
                    </div>
                </div>
                
                <div class="help-text">
                    <h4>ğŸ”‘ OAuth 2.0 Kurulumu</h4>
                    <ul>
                        <li>Google Cloud Console'da "Credentials" bÃ¶lÃ¼mÃ¼ne gidin</li>
                        <li>"Create Credentials" > "OAuth 2.0 Client ID" seÃ§in</li>
                        <li>"Web application" tipini seÃ§in</li>
                        <li>Authorized JavaScript origins'a localhost'u ekleyin</li>
                        <li>Authorized redirect URIs'e callback URL'i ekleyin</li>
                    </ul>
                </div>
            </div>
            
            <!-- Step 3: Validation -->
            <div class="step-content" data-step="3">
                <h2>ğŸ§ª YapÄ±landÄ±rma DoÄŸrulama</h2>
                <p>API baÄŸlantÄ±sÄ±nÄ± test edin ve yapÄ±landÄ±rmanÄ±zÄ± doÄŸrulayÄ±n.</p>
                
                <div id="validation-results"></div>
                
                <div class="wizard-actions">
                    <button class="btn btn-secondary" onclick="testConfiguration()">
                        ğŸ§ª Test Et
                    </button>
                </div>
            </div>
            
            <!-- Step 4: Complete -->
            <div class="step-content" data-step="4">
                <h2>âœ… Kurulum TamamlandÄ±!</h2>
                <p>Sistem baÅŸarÄ±yla yapÄ±landÄ±rÄ±ldÄ±. Åimdi ana uygulamaya geÃ§ebilirsiniz.</p>
                
                <div class="validation-status success">
                    <span>âœ…</span>
                    <span>TÃ¼m ayarlar baÅŸarÄ±yla kaydedildi ve doÄŸrulandÄ±</span>
                </div>
                
                <div class="wizard-actions">
                    <a href="index.html" class="btn btn-success">
                        ğŸš€ Ana Sayfaya Git
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Navigation Buttons -->
        <div class="wizard-actions">
            <button class="btn btn-secondary" id="prev-btn" onclick="previousStep()" style="display: none;">
                â† Ã–nceki
            </button>
            <button class="btn btn-primary" id="next-btn" onclick="nextStep()">
                Sonraki â†’
            </button>
        </div>
    </div>

    <script src="js/config.js?v=20260130-1"></script>
    <script src="js/password-security.js?v=20260130-1"></script>
    <script src="js/error-handler.js?v=20260130-1"></script>
    <script>
        let currentStep = 1;
        const totalSteps = 4;
        
        function updateProgressBar() {
            const progressBar = document.querySelector('.progress-bar');
            progressBar.setAttribute('data-step', currentStep);
            
            // Update step indicators
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 < currentStep) {
                    step.classList.add('completed');
                } else if (index + 1 === currentStep) {
                    step.classList.add('active');
                }
            });
        }
        
        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show current step
            document.querySelector(`.step-content[data-step="${step}"]`).classList.add('active');
            
            // Update navigation buttons
            document.getElementById('prev-btn').style.display = step === 1 ? 'none' : 'block';
            document.getElementById('next-btn').style.display = step === totalSteps ? 'none' : 'block';
            
            updateProgressBar();
        }
        
        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStep < totalSteps) {
                    currentStep++;
                    showStep(currentStep);
                    
                    if (currentStep === 3) {
                        // Auto-test on validation step
                        setTimeout(testConfiguration, 500);
                    }
                }
            }
        }
        
        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }
        
        function validateCurrentStep() {
            switch(currentStep) {
                case 1:
                    const apiKey = document.getElementById('api-key').value;
                    const spreadsheetId = document.getElementById('spreadsheet-id').value;
                    
                    if (!apiKey || !spreadsheetId) {
                        alert('LÃ¼tfen tÃ¼m zorunlu alanlarÄ± doldurun.');
                        return false;
                    }
                    
                    if (!apiKey.startsWith('AIza')) {
                        alert('GeÃ§ersiz API Key formatÄ±.');
                        return false;
                    }
                    
                    return true;
                    
                case 2:
                    const clientId = document.getElementById('client-id').value;
                    const clientSecret = document.getElementById('client-secret').value;
                    const redirectUri = document.getElementById('redirect-uri').value;
                    
                    if (!clientId || !clientSecret || !redirectUri) {
                        alert('LÃ¼tfen tÃ¼m OAuth alanlarÄ±nÄ± doldurun.');
                        return false;
                    }
                    
                    return true;
                    
                default:
                    return true;
            }
        }
        
        async function testConfiguration() {
            const resultsDiv = document.getElementById('validation-results');
            resultsDiv.innerHTML = '<div class="validation-status warning"><span>â³</span><span>Test yapÄ±lÄ±yor...</span></div>';
            
            try {
                // Collect configuration
                const configData = {
                    GOOGLE_API_KEY: document.getElementById('api-key').value,
                    GOOGLE_SPREADSHEET_ID: document.getElementById('spreadsheet-id').value,
                    GOOGLE_CLIENT_ID: document.getElementById('client-id').value,
                    GOOGLE_CLIENT_SECRET: document.getElementById('client-secret').value,
                    GOOGLE_REDIRECT_URI: document.getElementById('redirect-uri').value,
                    APP_ENV: 'development',
                    MAX_USERS: 5
                };
                
                // Test Google Sheets API
                const testUrl = `https://sheets.googleapis.com/v4/spreadsheets/${configData.GOOGLE_SPREADSHEET_ID}?key=${configData.GOOGLE_API_KEY}`;
                const response = await fetch(testUrl);
                
                let results = '<div class="validation-status success"><span>âœ…</span><span>Google Sheets API baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±!</span></div>';
                
                if (response.ok) {
                    const data = await response.json();
                    results += `<div class="validation-status success"><span>ğŸ“Š</span><span>Spreadsheet: ${data.properties.title}</span></div>`;
                } else {
                    results += '<div class="validation-status error"><span>âŒ</span><span>API baÄŸlantÄ±sÄ± baÅŸarÄ±sÄ±z</span></div>';
                }
                
                // Save configuration
                config.initializeFromUser(configData);
                
                resultsDiv.innerHTML = results;
                
                // Auto-advance to next step after successful test
                setTimeout(() => {
                    if (response.ok) {
                        currentStep = 4;
                        showStep(currentStep);
                    }
                }, 2000);
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="validation-status error"><span>âŒ</span><span>Test hatasÄ±: ${error.message}</span></div>`;
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showStep(1);
            
            // Load existing configuration if available
            document.getElementById('api-key').value = config.get('GOOGLE_API_KEY') || '';
            document.getElementById('spreadsheet-id').value = config.get('GOOGLE_SPREADSHEET_ID') || '';
            document.getElementById('client-id').value = config.get('GOOGLE_CLIENT_ID') || '';
            document.getElementById('client-secret').value = config.get('GOOGLE_CLIENT_SECRET') || '';
            document.getElementById('redirect-uri').value = config.get('GOOGLE_REDIRECT_URI') || 'http://localhost:3000/oauth-callback.html';
        });
    </script>
</body>
</html>
